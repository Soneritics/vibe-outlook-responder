/*! For license information please see 268.js.LICENSE.txt */
"use strict";(self.webpackChunkoutlook_ai_assistant=self.webpackChunkoutlook_ai_assistant||[]).push([[268],{548(e,t,s){s.d(t,{r:()=>r});var i=s(6540),o=s(7073),n=s(7246);const r=()=>{const e=(0,n.p)(),{targetDocument:t}=(0,o.Y)();return{findAllFocusable:i.useCallback((t,s)=>{var i;return t&&(null===(i=e.current)||void 0===i?void 0:i.focusable.findAll({container:t,acceptCondition:s}))||[]},[e]),findFirstFocusable:i.useCallback(t=>{var s;return t&&(null===(s=e.current)||void 0===s?void 0:s.focusable.findFirst({container:t}))},[e]),findLastFocusable:i.useCallback(t=>{var s;return t&&(null===(s=e.current)||void 0===s?void 0:s.focusable.findLast({container:t}))},[e]),findNextFocusable:i.useCallback((s,i={})=>{if(!e.current||!t||!s)return null;const{container:o=t.body}=i;return e.current.focusable.findNext({currentElement:s,container:o})},[e,t]),findPrevFocusable:i.useCallback((s,i={})=>{if(!e.current||!t||!s)return null;const{container:o=t.body}=i;return e.current.focusable.findPrev({currentElement:s,container:o})},[e,t])}}},7246(e,t,s){s.d(t,{p:()=>d});var i=s(6540),o=s(8443),n=s(7073);function r(e,t={}){if(!e)return null;if(!t.skipVirtual){const t=function(e){return(t=e)&&t._virtual&&e._virtual.parent||null;var t}(e);if(t)return t}const s=e.parentNode;return s&&11===s.nodeType?s.host:s}var a=s(3808);const l=e=>e;function d(e=l){const{targetDocument:t}=(0,n.Y)(),s=i.useRef(null);return(0,a.E)(()=>{const i=function(e){const t=(null==e?void 0:e.defaultView)||void 0,s=null==t?void 0:t.__tabsterShadowDOMAPI;if(t)return(0,o._A)(t,{autoRoot:{},controlTab:!1,getParent:r,checkUncontrolledCompletely:e=>{var t;return!0===(null===(t=e.firstElementChild)||void 0===t?void 0:t.hasAttribute("data-is-focus-trap-zone-bumper"))||void 0},DOMAPI:s})}(t);if(i)return s.current=e(i),()=>{(0,o.hC)(i),s.current=null}},[t,e]),s}},7403(e,t,s){s.d(t,{g:()=>r});var i=s(8443),o=s(7246),n=s(6540);const r=e=>{(0,o.p)();const t=(0,i.U6)(e,!0);return n.useMemo(()=>({[i.h7]:t}),[t])}},8443(e,t,s){s.d(t,{$d:()=>ye,Az:()=>Te,CP:()=>d,K9:()=>u,U6:()=>q,_A:()=>Ee,h7:()=>o,hC:()=>Fe,mz:()=>we});var i=s(7621);const o="data-tabster",n=`:is(${["a[href]","button","input","select","textarea","*[tabindex]","*[contenteditable]","details > summary","audio[controls]","video[controls]"].join(", ")}):not(:disabled)`,r=1,a=2,l=3,d={Source:0,Target:1},u={Unlimited:0,Limited:1,LimitedTrapFocus:2};function c(e,t){var s;return null===(s=e.storageEntry(t))||void 0===s?void 0:s.tabster}function h(e,t,s){var i,n,r;const a=s||e._noop?void 0:t.getAttribute(o);let l,d=e.storageEntry(t);if(a){if(a===(null===(i=null==d?void 0:d.attr)||void 0===i?void 0:i.string))return;try{const e=JSON.parse(a);if("object"!=typeof e)throw new Error(`Value is not a JSON object, got '${a}'.`);l={string:a,object:e}}catch(e){}}else if(!d)return;d||(d=e.storageEntry(t,!0)),d.tabster||(d.tabster={});const u=d.tabster||{},c=(null===(n=d.attr)||void 0===n?void 0:n.object)||{},h=(null==l?void 0:l.object)||{};for(const s of Object.keys(c))if(!h[s]){if("root"===s){const t=u[s];t&&e.root.onRoot(t,!0)}switch(s){case"deloser":case"root":case"groupper":case"modalizer":case"restorer":case"mover":const i=u[s];i&&(i.dispose(),delete u[s]);break;case"observed":delete u[s],e.observedElement&&e.observedElement.onObservedElementUpdate(t);break;case"focusable":case"outline":case"uncontrolled":case"sys":delete u[s]}}for(const s of Object.keys(h)){const i=h.sys;switch(s){case"deloser":u.deloser?u.deloser.setProps(h.deloser):e.deloser&&(u.deloser=e.deloser.createDeloser(t,h.deloser));break;case"root":u.root?u.root.setProps(h.root):u.root=e.root.createRoot(t,h.root,i),e.root.onRoot(u.root);break;case"modalizer":{let s;const o=e.modalizer;if(u.modalizer){const e=h.modalizer,t=e.id;t&&(null===(r=null==c?void 0:c.modalizer)||void 0===r?void 0:r.id)!==t?(u.modalizer.dispose(),s=e):u.modalizer.setProps(e)}else o&&(s=h.modalizer);o&&s&&(u.modalizer=o.createModalizer(t,s,i))}break;case"restorer":u.restorer?u.restorer.setProps(h.restorer):e.restorer&&h.restorer&&(u.restorer=e.restorer.createRestorer(t,h.restorer));break;case"focusable":u.focusable=h.focusable;break;case"groupper":u.groupper?u.groupper.setProps(h.groupper):e.groupper&&(u.groupper=e.groupper.createGroupper(t,h.groupper,i));break;case"mover":u.mover?u.mover.setProps(h.mover):e.mover&&(u.mover=e.mover.createMover(t,h.mover,i));break;case"observed":e.observedElement&&(u.observed=h.observed,e.observedElement.onObservedElementUpdate(t));break;case"uncontrolled":u.uncontrolled=h.uncontrolled;break;case"outline":e.outline&&(u.outline=h.outline);break;case"sys":u.sys=h.sys;break;default:console.error(`Unknown key '${s}' in data-tabster attribute value.`)}}l?d.attr=l:(0===Object.keys(u).length&&(delete d.tabster,delete d.attr),e.storageEntry(t,!1))}const m="tabster:groupper:movefocus",_="tabster:restorer:restore-focus",f="undefined"!=typeof CustomEvent?CustomEvent:function(){};class v extends f{constructor(e,t){super(e,{bubbles:!0,cancelable:!0,composed:!0,detail:t}),this.details=t}}class b extends v{constructor(e){super("tabster:focusin",e)}}class p extends v{constructor(e){super("tabster:focusout",e)}}class g extends v{constructor(e){super("tabster:movefocus",e)}}class E extends v{constructor(e){super("tabster:modalizer:active",e)}}class y extends v{constructor(e){super("tabster:modalizer:inactive",e)}}class T extends v{constructor(){super(_)}}class w extends v{constructor(e){super("tabster:root:focus",e)}}class F extends v{constructor(e){super("tabster:root:blur",e)}}const k={createMutationObserver:e=>new MutationObserver(e),createTreeWalker:(e,t,s,i)=>e.createTreeWalker(t,s,i),getParentNode:e=>e?e.parentNode:null,getParentElement:e=>e?e.parentElement:null,nodeContains:(e,t)=>!(!t||!(null==e?void 0:e.contains(t))),getActiveElement:e=>e.activeElement,querySelector:(e,t)=>e.querySelector(t),querySelectorAll:(e,t)=>Array.prototype.slice.call(e.querySelectorAll(t),0),getElementById:(e,t)=>e.getElementById(t),getFirstChild:e=>(null==e?void 0:e.firstChild)||null,getLastChild:e=>(null==e?void 0:e.lastChild)||null,getNextSibling:e=>(null==e?void 0:e.nextSibling)||null,getPreviousSibling:e=>(null==e?void 0:e.previousSibling)||null,getFirstElementChild:e=>(null==e?void 0:e.firstElementChild)||null,getLastElementChild:e=>(null==e?void 0:e.lastElementChild)||null,getNextElementSibling:e=>(null==e?void 0:e.nextElementSibling)||null,getPreviousElementSibling:e=>(null==e?void 0:e.previousElementSibling)||null,appendChild:(e,t)=>e.appendChild(t),insertBefore:(e,t,s)=>e.insertBefore(t,s),getSelection:e=>{var t;return(null===(t=e.ownerDocument)||void 0===t?void 0:t.getSelection())||null},getElementsByName:(e,t)=>e.ownerDocument.getElementsByName(t)};let I;"undefined"!=typeof DOMRect&&DOMRect;let C=0;try{document.createTreeWalker(document,NodeFilter.SHOW_ELEMENT),I=!1}catch(e){I=!0}function O(e){const t=e();let s=t.__tabsterInstanceContext;return s||(s={elementByUId:{},basics:{Promise:t.Promise||void 0,WeakRef:t.WeakRef||void 0},containerBoundingRectCache:{},lastContainerBoundingRectCacheId:0,fakeWeakRefs:[],fakeWeakRefsStarted:!1},t.__tabsterInstanceContext=s),s}class D{constructor(e){this._target=e}deref(){return this._target}static cleanup(e,t){return!e._target||!(!t&&S(e._target.ownerDocument,e._target))&&(delete e._target,!0)}}class A{constructor(e,t,s){const i=O(e);let o;i.WeakRef?o=new i.WeakRef(t):(o=new D(t),i.fakeWeakRefs.push(o)),this._ref=o,this._data=s}get(){const e=this._ref;let t;return e&&(t=e.deref(),t||delete this._ref),t}getData(){return this._data}}function P(e,t){const s=O(e);s.fakeWeakRefs=s.fakeWeakRefs.filter(e=>!D.cleanup(e,t))}function N(e){const t=O(e);t.fakeWeakRefsStarted||(t.fakeWeakRefsStarted=!0,t.WeakRef=function(e){return e.basics.WeakRef}(t)),t.fakeWeakRefsTimer||(t.fakeWeakRefsTimer=e().setTimeout(()=>{t.fakeWeakRefsTimer=void 0,P(e),N(e)},12e4))}function R(e,t,s){if(t.nodeType!==Node.ELEMENT_NODE)return;const i=I?s:{acceptNode:s};return k.createTreeWalker(e,t,NodeFilter.SHOW_ELEMENT,i,!1)}function x(e){return!!e.__shouldIgnoreFocus}function M(e,t){const s=O(e);let i=t.__tabsterElementUID;return i||(i=t.__tabsterElementUID=function(e){const t=new Uint32Array(4);if(e.crypto&&e.crypto.getRandomValues)e.crypto.getRandomValues(t);else if(e.msCrypto&&e.msCrypto.getRandomValues)e.msCrypto.getRandomValues(t);else for(let e=0;e<t.length;e++)t[e]=4294967295*Math.random();const s=[];for(let e=0;e<t.length;e++)s.push(t[e].toString(36));return s.push("|"),s.push((++C).toString(36)),s.push("|"),s.push(Date.now().toString(36)),s.join("")}(e())),!s.elementByUId[i]&&S(t.ownerDocument,t)&&(s.elementByUId[i]=new A(e,t)),i}function W(e,t){const s=O(e);for(const e of Object.keys(s.elementByUId)){const i=s.elementByUId[e],o=i&&i.get();o&&t&&!k.nodeContains(t,o)||delete s.elementByUId[e]}}function S(e,t){return k.nodeContains(null==e?void 0:e.body,t)}let L=0;class z{constructor(e,t,s){const i=e.getWindow;this._tabster=e,this._element=new A(i,t),this._props={...s},this.id="i"+ ++L}getElement(){return this._element.get()}getProps(){return this._props}setProps(e){this._props={...e}}}class U{constructor(e,t,s,o,n){var r;this._focusIn=e=>{if(this._fixedTarget){const e=this._fixedTarget.get();return void(e&&(0,i.kG)(e))}const t=this.input;if(this.onFocusIn&&t){const s=e.relatedTarget;this.onFocusIn(this,this._isBackward(!0,t,s),s)}},this._focusOut=e=>{if(this._fixedTarget)return;this.useDefaultAction=!1;const t=this.input;if(this.onFocusOut&&t){const s=e.relatedTarget;this.onFocusOut(this,this._isBackward(!1,t,s),s)}};const a=e(),l=a.document.createElement("i");l.tabIndex=0,l.setAttribute("role","none"),l.setAttribute("data-tabster-dummy",""),l.setAttribute("aria-hidden","true");const d=l.style;d.position="fixed",d.width=d.height="1px",d.opacity="0.001",d.zIndex="-1",d.setProperty("content-visibility","hidden"),function(e){e.__shouldIgnoreFocus=!0}(l),this.input=l,this.isFirst=s.isFirst,this.isOutside=t,this._isPhantom=null!==(r=s.isPhantom)&&void 0!==r&&r,this._fixedTarget=n,l.addEventListener("focusin",this._focusIn),l.addEventListener("focusout",this._focusOut),l.__tabsterDummyContainer=o,this._isPhantom&&(this._disposeTimer=a.setTimeout(()=>{delete this._disposeTimer,this.dispose()},0),this._clearDisposeTimeout=()=>{this._disposeTimer&&(a.clearTimeout(this._disposeTimer),delete this._disposeTimer),delete this._clearDisposeTimeout})}dispose(){var e;this._clearDisposeTimeout&&this._clearDisposeTimeout();const t=this.input;t&&(delete this._fixedTarget,delete this.onFocusIn,delete this.onFocusOut,delete this.input,t.removeEventListener("focusin",this._focusIn),t.removeEventListener("focusout",this._focusOut),delete t.__tabsterDummyContainer,null===(e=k.getParentNode(t))||void 0===e||e.removeChild(t))}setTopLeft(e,t){var s;const i=null===(s=this.input)||void 0===s?void 0:s.style;i&&(i.top=`${e}px`,i.left=`${t}px`)}_isBackward(e,t,s){return e&&!s?!this.isFirst:!!(s&&t.compareDocumentPosition(s)&Node.DOCUMENT_POSITION_FOLLOWING)}}class B{constructor(e,t,s,i,o,n){this._element=t,this._instance=new V(e,t,this,s,i,o,n)}_setHandlers(e,t){this._onFocusIn=e,this._onFocusOut=t}moveOut(e){var t;null===(t=this._instance)||void 0===t||t.moveOut(e)}moveOutWithDefaultAction(e,t){var s;null===(s=this._instance)||void 0===s||s.moveOutWithDefaultAction(e,t)}getHandler(e){return e?this._onFocusIn:this._onFocusOut}setTabbable(e){var t;null===(t=this._instance)||void 0===t||t.setTabbable(this,e)}dispose(){this._instance&&(this._instance.dispose(this),delete this._instance),delete this._onFocusIn,delete this._onFocusOut}static moveWithPhantomDummy(e,t,s,o,n){const r=new U(e.getWindow,!0,{isPhantom:!0,isFirst:!0}).input;if(r){let a,l;if("BODY"===t.tagName)a=t,l=s&&o||!s&&!o?k.getFirstElementChild(t):null;else{let i,n;s&&(!o||o&&!e.focusable.isFocusable(t,!1,!0,!0))?(a=t,l=o?t.firstElementChild:null):(a=k.getParentElement(t),l=s&&o||!s&&!o?t:k.getNextElementSibling(t));do{i=s&&o||!s&&!o?k.getPreviousElementSibling(l):l,n=Q(i),n===t?l=s&&o||!s&&!o?i:k.getNextElementSibling(i):n=null}while(n)}(null==a?void 0:a.dispatchEvent(new g({by:"root",owner:a,next:null,relatedEvent:n})))&&(k.insertBefore(a,r,l),(0,i.kG)(r))}}static addPhantomDummyWithTarget(e,t,s,i){const o=new U(e.getWindow,!0,{isPhantom:!0,isFirst:!0},void 0,new A(e.getWindow,i)).input;if(o){let e,i;t.querySelector(n)&&!s?(e=t,i=k.getFirstElementChild(t)):(e=k.getParentElement(t),i=s?t:k.getNextElementSibling(t)),e&&k.insertBefore(e,o,i)}}}class K{constructor(e){this._updateQueue=new Set,this._lastUpdateQueueTime=0,this._changedParents=new WeakSet,this._dummyElements=[],this._dummyCallbacks=new WeakMap,this._domChanged=e=>{var t;this._changedParents.has(e)||(this._changedParents.add(e),this._updateDummyInputsTimer||(this._updateDummyInputsTimer=null===(t=this._win)||void 0===t?void 0:t.call(this).setTimeout(()=>{delete this._updateDummyInputsTimer;for(const e of this._dummyElements){const t=e.get();if(t){const e=this._dummyCallbacks.get(t);if(e){const s=k.getParentNode(t);s&&!this._changedParents.has(s)||e()}}}this._changedParents=new WeakSet},100)))},this._win=e}add(e,t){!this._dummyCallbacks.has(e)&&this._win&&(this._dummyElements.push(new A(this._win,e)),this._dummyCallbacks.set(e,t),this.domChanged=this._domChanged)}remove(e){this._dummyElements=this._dummyElements.filter(t=>{const s=t.get();return s&&s!==e}),this._dummyCallbacks.delete(e),0===this._dummyElements.length&&delete this.domChanged}dispose(){var e;const t=null===(e=this._win)||void 0===e?void 0:e.call(this);this._updateTimer&&(null==t||t.clearTimeout(this._updateTimer),delete this._updateTimer),this._updateDummyInputsTimer&&(null==t||t.clearTimeout(this._updateDummyInputsTimer),delete this._updateDummyInputsTimer),this._changedParents=new WeakSet,this._dummyCallbacks=new WeakMap,this._dummyElements=[],this._updateQueue.clear(),delete this.domChanged,delete this._win}updatePositions(e){this._win&&(this._updateQueue.add(e),this._lastUpdateQueueTime=Date.now(),this._scheduledUpdatePositions())}_scheduledUpdatePositions(){var e;this._updateTimer||(this._updateTimer=null===(e=this._win)||void 0===e?void 0:e.call(this).setTimeout(()=>{if(delete this._updateTimer,this._lastUpdateQueueTime+100<=Date.now()){const e=new Map,t=[];for(const s of this._updateQueue)t.push(s(e));this._updateQueue.clear();for(const e of t)e();e.clear()}else this._scheduledUpdatePositions()},100))}}class V{constructor(e,t,s,o,n,r,a){this._wrappers=[],this._isOutside=!1,this._transformElements=new Set,this._onFocusIn=(e,t,s)=>{this._onFocus(!0,e,t,s)},this._onFocusOut=(e,t,s)=>{this._onFocus(!1,e,t,s)},this.moveOut=e=>{var t;const s=this._firstDummy,o=this._lastDummy;if(s&&o){this._ensurePosition();const n=s.input,r=o.input,a=null===(t=this._element)||void 0===t?void 0:t.get();if(n&&r&&a){let t;e?(n.tabIndex=0,t=n):(r.tabIndex=0,t=r),t&&(0,i.kG)(t)}}},this.moveOutWithDefaultAction=(e,t)=>{var s;const o=this._firstDummy,n=this._lastDummy;if(o&&n){this._ensurePosition();const r=o.input,a=n.input,l=null===(s=this._element)||void 0===s?void 0:s.get();if(r&&a&&l){let s;e?!o.isOutside&&this._tabster.focusable.isFocusable(l,!0,!0,!0)?s=l:(o.useDefaultAction=!0,r.tabIndex=0,s=r):(n.useDefaultAction=!0,a.tabIndex=0,s=a),s&&l.dispatchEvent(new g({by:"root",owner:l,next:null,relatedEvent:t}))&&(0,i.kG)(s)}}},this.setTabbable=(e,t)=>{var s,i;for(const s of this._wrappers)if(s.manager===e){s.tabbable=t;break}const o=this._getCurrent();if(o){const e=o.tabbable?0:-1;let t=null===(s=this._firstDummy)||void 0===s?void 0:s.input;t&&(t.tabIndex=e),t=null===(i=this._lastDummy)||void 0===i?void 0:i.input,t&&(t.tabIndex=e)}},this._addDummyInputs=()=>{this._addTimer||(this._addTimer=this._getWindow().setTimeout(()=>{delete this._addTimer,this._ensurePosition(),this._addTransformOffsets()},0))},this._addTransformOffsets=()=>{this._tabster._dummyObserver.updatePositions(this._computeTransformOffsets)},this._computeTransformOffsets=e=>{var t,s;const i=(null===(t=this._firstDummy)||void 0===t?void 0:t.input)||(null===(s=this._lastDummy)||void 0===s?void 0:s.input),o=this._transformElements,n=new Set;let r=0,a=0;const l=this._getWindow();for(let t=i;t&&t.nodeType===Node.ELEMENT_NODE;t=k.getParentElement(t)){let s=e.get(t);if(void 0===s){const i=l.getComputedStyle(t).transform;i&&"none"!==i&&(s={scrollTop:t.scrollTop,scrollLeft:t.scrollLeft}),e.set(t,s||null)}s&&(n.add(t),o.has(t)||t.addEventListener("scroll",this._addTransformOffsets),r+=s.scrollTop,a+=s.scrollLeft)}for(const e of o)n.has(e)||e.removeEventListener("scroll",this._addTransformOffsets);return this._transformElements=n,()=>{var e,t;null===(e=this._firstDummy)||void 0===e||e.setTopLeft(r,a),null===(t=this._lastDummy)||void 0===t||t.setTopLeft(r,a)}};const l=t.get();if(!l)throw new Error("No element");this._tabster=e,this._getWindow=e.getWindow,this._callForDefaultAction=a;const d=l.__tabsterDummy;if((d||this)._wrappers.push({manager:s,priority:o,tabbable:!0}),d)return d;l.__tabsterDummy=this;const u=null==n?void 0:n.dummyInputsPosition,c=l.tagName;this._isOutside=u?2===u:(r||"UL"===c||"OL"===c||"TABLE"===c)&&!("LI"===c||"TD"===c||"TH"===c),this._firstDummy=new U(this._getWindow,this._isOutside,{isFirst:!0},t),this._lastDummy=new U(this._getWindow,this._isOutside,{isFirst:!1},t);const h=this._firstDummy.input;h&&e._dummyObserver.add(h,this._addDummyInputs),this._firstDummy.onFocusIn=this._onFocusIn,this._firstDummy.onFocusOut=this._onFocusOut,this._lastDummy.onFocusIn=this._onFocusIn,this._lastDummy.onFocusOut=this._onFocusOut,this._element=t,this._addDummyInputs()}dispose(e,t){var s,i,o,n;if(0===(this._wrappers=this._wrappers.filter(s=>s.manager!==e&&!t)).length){delete(null===(s=this._element)||void 0===s?void 0:s.get()).__tabsterDummy;for(const e of this._transformElements)e.removeEventListener("scroll",this._addTransformOffsets);this._transformElements.clear();const e=this._getWindow();this._addTimer&&(e.clearTimeout(this._addTimer),delete this._addTimer);const t=null===(i=this._firstDummy)||void 0===i?void 0:i.input;t&&this._tabster._dummyObserver.remove(t),null===(o=this._firstDummy)||void 0===o||o.dispose(),null===(n=this._lastDummy)||void 0===n||n.dispose()}}_onFocus(e,t,s,i){var o;const n=this._getCurrent();!n||t.useDefaultAction&&!this._callForDefaultAction||null===(o=n.manager.getHandler(e))||void 0===o||o(t,s,i)}_getCurrent(){return this._wrappers.sort((e,t)=>e.tabbable!==t.tabbable?e.tabbable?-1:1:e.priority-t.priority),this._wrappers[0]}_ensurePosition(){var e,t,s;const i=null===(e=this._element)||void 0===e?void 0:e.get(),o=null===(t=this._firstDummy)||void 0===t?void 0:t.input,n=null===(s=this._lastDummy)||void 0===s?void 0:s.input;if(i&&o&&n)if(this._isOutside){const e=k.getParentNode(i);if(e){const t=k.getNextSibling(i);t!==n&&k.insertBefore(e,n,t),k.getPreviousElementSibling(i)!==o&&k.insertBefore(e,o,i)}}else{k.getLastElementChild(i)!==n&&k.appendChild(i,n);const e=k.getFirstElementChild(i);e&&e!==o&&e.parentNode&&k.insertBefore(e.parentNode,o,e)}}}function G(e){let t=null;for(let s=k.getLastElementChild(e);s;s=k.getLastElementChild(s))t=s;return t||void 0}function j(e,t,s,i){const o=e.storageEntry(t,!0);let n=!1;if(!o.aug){if(void 0===i)return n;o.aug={}}if(void 0===i){if(s in o.aug){const e=o.aug[s];delete o.aug[s],null===e?t.removeAttribute(s):t.setAttribute(s,e),n=!0}}else{let e;s in o.aug||(e=t.getAttribute(s)),void 0!==e&&e!==i&&(o.aug[s]=e,null===i?t.removeAttribute(s):t.setAttribute(s,i),n=!0)}return void 0===i&&0===Object.keys(o.aug).length&&(delete o.aug,e.storageEntry(t,!1)),n}function H(e){return"INPUT"===e.tagName&&!!e.name&&"radio"===e.type}function Q(e){var t;return(null===(t=null==e?void 0:e.__tabsterDummyContainer)||void 0===t?void 0:t.get())||null}function q(e,t){const s=JSON.stringify(e);return!0===t?s:{[o]:s}}class J extends B{constructor(e,t,s,o){super(e,t,1,o,void 0,!0),this._onDummyInputFocus=e=>{var t;if(e.useDefaultAction)this._setFocused(!1);else{this._tabster.keyboardNavigation.setNavigatingWithKeyboard(!0);const s=this._element.get();if(s){this._setFocused(!0);const t=this._tabster.focusedElement.getFirstOrLastTabbable(e.isFirst,{container:s,ignoreAccessibility:!0});if(t)return void(0,i.kG)(t)}null===(t=e.input)||void 0===t||t.blur()}},this._setHandlers(this._onDummyInputFocus),this._tabster=e,this._setFocused=s}}class Y extends z{constructor(e,t,s,o,n){super(e,t,o),this._isFocused=!1,this._setFocused=e=>{var t;if(this._setFocusedTimer&&(this._tabster.getWindow().clearTimeout(this._setFocusedTimer),delete this._setFocusedTimer),this._isFocused===e)return;const s=this._element.get();s&&(e?(this._isFocused=!0,null===(t=this._dummyManager)||void 0===t||t.setTabbable(!1),s.dispatchEvent(new w({element:s}))):this._setFocusedTimer=this._tabster.getWindow().setTimeout(()=>{var e;delete this._setFocusedTimer,this._isFocused=!1,null===(e=this._dummyManager)||void 0===e||e.setTabbable(!0),s.dispatchEvent(new F({element:s}))},0))},this._onFocusIn=e=>{const t=this._tabster.getParent,s=this._element.get();let i=e.composedPath()[0];do{if(i===s)return void this._setFocused(!0);i=i&&t(i)}while(i)},this._onFocusOut=()=>{this._setFocused(!1)},this._onDispose=s;const r=e.getWindow;this.uid=M(r,t),this._sys=n,(e.controlTab||e.rootDummyInputs)&&this.addDummyInputs();const a=r().document;a.addEventListener(i.Oy,this._onFocusIn),a.addEventListener(i.RY,this._onFocusOut),this._add()}addDummyInputs(){this._dummyManager||(this._dummyManager=new J(this._tabster,this._element,this._setFocused,this._sys))}dispose(){var e;this._onDispose(this);const t=this._tabster.getWindow(),s=t.document;s.removeEventListener(i.Oy,this._onFocusIn),s.removeEventListener(i.RY,this._onFocusOut),this._setFocusedTimer&&(t.clearTimeout(this._setFocusedTimer),delete this._setFocusedTimer),null===(e=this._dummyManager)||void 0===e||e.dispose(),this._remove()}moveOutWithDefaultAction(e,t){const s=this._dummyManager;if(s)s.moveOutWithDefaultAction(e,t);else{const s=this.getElement();s&&J.moveWithPhantomDummy(this._tabster,s,!0,e,t)}}_add(){}_remove(){}}class ${constructor(e,t){this._autoRootWaiting=!1,this._roots={},this._forceDummy=!1,this.rootById={},this._autoRootCreate=()=>{var e;const t=this._win().document,s=t.body;if(s){this._autoRootUnwait(t);const i=this._autoRoot;if(i)return function(e,t,s){let i;if(s){const t=e.getAttribute(o);if(t)try{i=JSON.parse(t)}catch(e){}}i||(i={}),function(e,t){for(const s of Object.keys(t)){const i=t[s];i?e[s]=i:delete e[s]}}(i,t),Object.keys(i).length>0?e.setAttribute(o,q(i,!0)):e.removeAttribute(o)}(s,{root:i},!0),h(this._tabster,s),null===(e=c(this._tabster,s))||void 0===e?void 0:e.root}else this._autoRootWaiting||(this._autoRootWaiting=!0,t.addEventListener("readystatechange",this._autoRootCreate))},this._onRootDispose=e=>{delete this._roots[e.id]},this._tabster=e,this._win=e.getWindow,this._autoRoot=t,e.queueInit(()=>{this._autoRoot&&this._autoRootCreate()})}_autoRootUnwait(e){e.removeEventListener("readystatechange",this._autoRootCreate),this._autoRootWaiting=!1}dispose(){const e=this._win();this._autoRootUnwait(e.document),delete this._autoRoot,Object.keys(this._roots).forEach(e=>{this._roots[e]&&(this._roots[e].dispose(),delete this._roots[e])}),this.rootById={}}createRoot(e,t,s){const i=new Y(this._tabster,e,this._onRootDispose,t,s);return this._roots[i.id]=i,this._forceDummy&&i.addDummyInputs(),i}addDummyInputs(){this._forceDummy=!0;const e=this._roots;for(const t of Object.keys(e))e[t].addDummyInputs()}static getRootByUId(e,t){const s=e().__tabsterInstance;return s&&s.root.rootById[t]}static getTabsterContext(e,t,s={}){var i,o,n,r;if(!t.ownerDocument)return;const{checkRtl:a,referenceElement:l}=s,d=e.getParent;let u,h,m,_;e.drainInitQueue();let f,v,b,p,g=!1,E=l||t;const y={};for(;E&&(!u||a);){const s=c(e,E);if(a&&void 0===b){const e=E.dir;e&&(b="rtl"===e.toLowerCase())}if(!s){E=d(E);continue}const r=E.tagName;(s.uncontrolled||"IFRAME"===r||"WEBVIEW"===r)&&e.focusable.isVisible(E)&&(p=E),_||!(null===(i=s.focusable)||void 0===i?void 0:i.excludeFromMover)||m||(g=!0);const l=s.modalizer,T=s.groupper,w=s.mover;!h&&l&&(h=l),m||!T||h&&!l||(h?(!T.isActive()&&T.getProps().tabbability&&h.userId!==(null===(o=e.modalizer)||void 0===o?void 0:o.activeId)&&(h=void 0,m=T),v=T):m=T),_||!w||h&&!l||T&&E===t||!E.contains(t)||(_=w,f=!!m&&m!==T),s.root&&(u=s.root),(null===(n=s.focusable)||void 0===n?void 0:n.ignoreKeydown)&&Object.assign(y,s.focusable.ignoreKeydown),E=d(E)}if(!u){const s=e.root;s._autoRoot&&(null===(r=t.ownerDocument)||void 0===r?void 0:r.body)&&(u=s._autoRootCreate())}return m&&!_&&(f=!0),u?{root:u,modalizer:h,groupper:m,mover:_,groupperBeforeMover:f,modalizerInGroupper:v,rtl:a?!!b:void 0,uncontrolled:p,excludedFromMover:g,ignoreKeydown:e=>!!y[e.key]}:void 0}static getRoot(e,t){var s;const i=e.getParent;for(let o=t;o;o=i(o)){const t=null===(s=c(e,o))||void 0===s?void 0:s.root;if(t)return t}}onRoot(e,t){t?delete this.rootById[e.uid]:this.rootById[e.uid]=e}}class X{constructor(){this._callbacks=[]}dispose(){this._callbacks=[],delete this._val}subscribe(e){const t=this._callbacks;t.indexOf(e)<0&&t.push(e)}subscribeFirst(e){const t=this._callbacks,s=t.indexOf(e);s>=0&&t.splice(s,1),t.unshift(e)}unsubscribe(e){const t=this._callbacks.indexOf(e);t>=0&&this._callbacks.splice(t,1)}setVal(e,t){this._val!==e&&(this._val=e,this._callCallbacks(e,t))}getVal(){return this._val}trigger(e,t){this._callCallbacks(e,t)}_callCallbacks(e,t){this._callbacks.forEach(s=>s(e,t))}}class Z{constructor(e){this._tabster=e}dispose(){}getProps(e){const t=c(this._tabster,e);return t&&t.focusable||{}}isFocusable(e,t,s,i){return!(!function(e,t){const s=e.matches||e.matchesSelector||e.msMatchesSelector||e.webkitMatchesSelector;return s&&s.call(e,t)}(e,n)||!t&&-1===e.tabIndex)&&(s||this.isVisible(e))&&(i||this.isAccessible(e))}isVisible(e){if(!e.ownerDocument||e.nodeType!==Node.ELEMENT_NODE)return!1;if(function(e){var t,s;const i=e.ownerDocument,o=null===(t=i.defaultView)||void 0===t?void 0:t.getComputedStyle(e);if(null===e.offsetParent&&i.body!==e&&"fixed"!==(null==o?void 0:o.position))return!0;if("hidden"===(null==o?void 0:o.visibility))return!0;if("fixed"===(null==o?void 0:o.position)){if("none"===o.display)return!0;if(null===(null===(s=e.parentElement)||void 0===s?void 0:s.offsetParent)&&i.body!==e.parentElement)return!0}return!1}(e))return!1;const t=e.ownerDocument.body.getBoundingClientRect();return 0!==t.width||0!==t.height}isAccessible(e){var t;for(let s=e;s;s=k.getParentElement(s)){const e=c(this._tabster,s);if(this._isHidden(s))return!1;if(!(null===(t=null==e?void 0:e.focusable)||void 0===t?void 0:t.ignoreAriaDisabled)&&this._isDisabled(s))return!1}return!0}_isDisabled(e){return e.hasAttribute("disabled")}_isHidden(e){var t;const s=e.getAttribute("aria-hidden");return!(!s||"true"!==s.toLowerCase()||(null===(t=this._tabster.modalizer)||void 0===t?void 0:t.isAugmented(e)))}findFirst(e,t){return this.findElement({...e},t)}findLast(e,t){return this.findElement({isBackward:!0,...e},t)}findNext(e,t){return this.findElement({...e},t)}findPrev(e,t){return this.findElement({...e,isBackward:!0},t)}findDefault(e,t){return this.findElement({...e,acceptCondition:t=>this.isFocusable(t,e.includeProgrammaticallyFocusable)&&!!this.getProps(t).isDefault},t)||null}findAll(e){return this._findElements(!0,e)||[]}findElement(e,t){const s=this._findElements(!1,e,t);return s?s[0]:s}_findElements(e,t,s){var i,o,n;const{container:r,currentElement:a=null,includeProgrammaticallyFocusable:l,useActiveModalizer:d,ignoreAccessibility:u,modalizerId:c,isBackward:h,onElement:m}=t;s||(s={});const _=[];let{acceptCondition:f}=t;const v=!!f;if(!r)return null;f||(f=e=>this.isFocusable(e,l,!1,u));const b={container:r,modalizerUserId:void 0===c&&d?null===(i=this._tabster.modalizer)||void 0===i?void 0:i.activeId:c||(null===(n=null===(o=$.getTabsterContext(this._tabster,r))||void 0===o?void 0:o.modalizer)||void 0===n?void 0:n.userId),from:a||r,isBackward:h,isFindAll:e,acceptCondition:f,hasCustomCondition:v,includeProgrammaticallyFocusable:l,ignoreAccessibility:u,cachedGrouppers:{},cachedRadioGroups:{}},p=R(r.ownerDocument,r,e=>this._acceptElement(e,b));if(!p)return null;const g=t=>{var i,o;const n=null!==(i=b.foundElement)&&void 0!==i?i:b.foundBackward;return n&&_.push(n),e?!(n&&(b.found=!1,delete b.foundElement,delete b.foundBackward,delete b.fromCtx,b.from=n,m&&!m(n))||!n&&!t):(n&&s&&(s.uncontrolled=null===(o=$.getTabsterContext(this._tabster,n))||void 0===o?void 0:o.uncontrolled),!(!t||n))};if(a||(s.outOfDOMOrder=!0),a&&k.nodeContains(r,a))p.currentNode=a;else if(h){const e=G(r);if(!e)return null;if(this._acceptElement(e,b)===NodeFilter.FILTER_ACCEPT&&!g(!0))return b.skippedFocusable&&(s.outOfDOMOrder=!0),_;p.currentNode=e}do{h?p.previousNode():p.nextNode()}while(g());return b.skippedFocusable&&(s.outOfDOMOrder=!0),_.length?_:null}_acceptElement(e,t){var s,i,o;if(t.found)return NodeFilter.FILTER_ACCEPT;const n=t.foundBackward;if(n&&(e===n||!k.nodeContains(n,e)))return t.found=!0,t.foundElement=n,NodeFilter.FILTER_ACCEPT;const r=t.container;if(e===r)return NodeFilter.FILTER_SKIP;if(!k.nodeContains(r,e))return NodeFilter.FILTER_REJECT;if(Q(e))return NodeFilter.FILTER_REJECT;if(k.nodeContains(t.rejectElementsFrom,e))return NodeFilter.FILTER_REJECT;const a=t.currentCtx=$.getTabsterContext(this._tabster,e);if(!a)return NodeFilter.FILTER_SKIP;if(x(e))return this.isFocusable(e,void 0,!0,!0)&&(t.skippedFocusable=!0),NodeFilter.FILTER_SKIP;if(!t.hasCustomCondition&&("IFRAME"===e.tagName||"WEBVIEW"===e.tagName))return this.isVisible(e)&&(null===(s=a.modalizer)||void 0===s?void 0:s.userId)===(null===(i=this._tabster.modalizer)||void 0===i?void 0:i.activeId)?(t.found=!0,t.rejectElementsFrom=t.foundElement=e,NodeFilter.FILTER_ACCEPT):NodeFilter.FILTER_REJECT;if(!t.ignoreAccessibility&&!this.isAccessible(e))return this.isFocusable(e,!1,!0,!0)&&(t.skippedFocusable=!0),NodeFilter.FILTER_REJECT;let l,d=t.fromCtx;d||(d=t.fromCtx=$.getTabsterContext(this._tabster,t.from));const u=null==d?void 0:d.mover;let c=a.groupper,h=a.mover;if(l=null===(o=this._tabster.modalizer)||void 0===o?void 0:o.acceptElement(e,t),void 0!==l&&(t.skippedFocusable=!0),void 0===l&&(c||h||u)){const s=null==c?void 0:c.getElement(),i=null==u?void 0:u.getElement();let o=null==h?void 0:h.getElement();if(o&&k.nodeContains(i,o)&&k.nodeContains(r,i)&&(!s||!h||k.nodeContains(i,s))&&(h=u,o=i),s)if(s!==r&&k.nodeContains(r,s)){if(!k.nodeContains(s,e))return NodeFilter.FILTER_REJECT}else c=void 0;if(o)if(k.nodeContains(r,o)){if(!k.nodeContains(o,e))return NodeFilter.FILTER_REJECT}else h=void 0;c&&h&&(o&&s&&!k.nodeContains(s,o)?h=void 0:c=void 0),c&&(l=c.acceptElement(e,t)),h&&(l=h.acceptElement(e,t))}if(void 0===l&&(l=t.acceptCondition(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP,l===NodeFilter.FILTER_SKIP&&this.isFocusable(e,!1,!0,!0)&&(t.skippedFocusable=!0)),l===NodeFilter.FILTER_ACCEPT&&!t.found){if(!t.isFindAll&&H(e)&&!e.checked){const s=e.name;let i=t.cachedRadioGroups[s];if(i||(i=function(e){if(!H(e))return;const t=e.name;let s,i=Array.from(k.getElementsByName(e,t));return i=i.filter(e=>!!H(e)&&(e.checked&&(s=e),!0)),{name:t,buttons:new Set(i),checked:s}}(e),i&&(t.cachedRadioGroups[s]=i)),(null==i?void 0:i.checked)&&i.checked!==e)return NodeFilter.FILTER_SKIP}t.isBackward?(t.foundBackward=e,l=NodeFilter.FILTER_SKIP):(t.found=!0,t.foundElement=e)}return l}}const ee="Enter",te="Escape",se={[a]:0,[l]:1,[r]:2};class ie extends X{constructor(e,t){super(),this._init=()=>{const e=this._win(),t=e.document;t.addEventListener(i.Oy,this._onFocusIn,!0),t.addEventListener(i.RY,this._onFocusOut,!0),e.addEventListener("keydown",this._onKeyDown,!0);const s=k.getActiveElement(t);s&&s!==t.body&&this._setFocusedElement(s),this.subscribe(this._onChanged)},this._onFocusIn=e=>{const t=e.composedPath()[0];t&&this._setFocusedElement(t,e.detail.relatedTarget,e.detail.isFocusedProgrammatically)},this._onFocusOut=e=>{var t;this._setFocusedElement(void 0,null===(t=e.detail)||void 0===t?void 0:t.originalEvent.relatedTarget)},this._validateFocusedElement=e=>{},this._onKeyDown=e=>{if("Tab"!==e.key||e.ctrlKey)return;const t=this.getVal();if(!t||!t.ownerDocument||"true"===t.contentEditable)return;const s=this._tabster,o=s.controlTab,n=$.getTabsterContext(s,t);if(!n||n.ignoreKeydown(e))return;const r=e.shiftKey,a=ie.findNextTabbable(s,n,void 0,t,void 0,r,!0),l=n.root.getElement();if(!l)return;const d=null==a?void 0:a.element,u=function(e,t){var s;const i=e.getParent;let o=t;do{const t=null===(s=c(e,o))||void 0===s?void 0:s.uncontrolled;if(t&&e.uncontrolled.isUncontrolledCompletely(o,!!t.completely))return o;o=i(o)}while(o)}(s,t);if(d){const c=a.uncontrolled;if(n.uncontrolled||k.nodeContains(c,t)){if(!a.outOfDOMOrder&&c===n.uncontrolled||u&&!k.nodeContains(u,d))return;return void B.addPhantomDummyWithTarget(s,t,r,d)}if(c&&s.focusable.isVisible(c)||"IFRAME"===d.tagName&&s.focusable.isVisible(d))return void(l.dispatchEvent(new g({by:"root",owner:l,next:d,relatedEvent:e}))&&B.moveWithPhantomDummy(s,null!=c?c:d,!1,r,e));(o||(null==a?void 0:a.outOfDOMOrder))&&l.dispatchEvent(new g({by:"root",owner:l,next:d,relatedEvent:e}))&&(e.preventDefault(),e.stopImmediatePropagation(),(0,i.kG)(d))}else!u&&l.dispatchEvent(new g({by:"root",owner:l,next:null,relatedEvent:e}))&&n.root.moveOutWithDefaultAction(r,e)},this._onChanged=(e,t)=>{var s,i;if(e)e.dispatchEvent(new b(t));else{const e=null===(s=this._lastVal)||void 0===s?void 0:s.get();if(e){const s={...t},o=$.getTabsterContext(this._tabster,e),n=null===(i=null==o?void 0:o.modalizer)||void 0===i?void 0:i.userId;n&&(s.modalizerId=n),e.dispatchEvent(new p(s))}}},this._tabster=e,this._win=t,e.queueInit(this._init)}dispose(){super.dispose();const e=this._win(),t=e.document;t.removeEventListener(i.Oy,this._onFocusIn,!0),t.removeEventListener(i.RY,this._onFocusOut,!0),e.removeEventListener("keydown",this._onKeyDown,!0),this.unsubscribe(this._onChanged);const s=this._asyncFocus;s&&(e.clearTimeout(s.timeout),delete this._asyncFocus),delete ie._lastResetElement,delete this._nextVal,delete this._lastVal}static forgetMemorized(e,t){var s,i;let o=ie._lastResetElement,n=o&&o.get();n&&k.nodeContains(t,n)&&delete ie._lastResetElement,n=null===(i=null===(s=e._nextVal)||void 0===s?void 0:s.element)||void 0===i?void 0:i.get(),n&&k.nodeContains(t,n)&&delete e._nextVal,o=e._lastVal,n=o&&o.get(),n&&k.nodeContains(t,n)&&delete e._lastVal}getFocusedElement(){return this.getVal()}getLastFocusedElement(){var e;let t=null===(e=this._lastVal)||void 0===e?void 0:e.get();return(!t||t&&!S(t.ownerDocument,t))&&(this._lastVal=t=void 0),t}focus(e,t,s,i){return!!this._tabster.focusable.isFocusable(e,t,!1,s)&&(e.focus({preventScroll:i}),!0)}focusDefault(e){const t=this._tabster.focusable.findDefault({container:e});return!!t&&(this._tabster.focusedElement.focus(t),!0)}getFirstOrLastTabbable(e,t){var s;const{container:i,ignoreAccessibility:o}=t;let n;if(i){const t=$.getTabsterContext(this._tabster,i);t&&(n=null===(s=ie.findNextTabbable(this._tabster,t,i,void 0,void 0,!e,o))||void 0===s?void 0:s.element)}return n&&!k.nodeContains(i,n)&&(n=void 0),n||void 0}_focusFirstOrLast(e,t){const s=this.getFirstOrLastTabbable(e,t);return!!s&&(this.focus(s,!1,!0),!0)}focusFirst(e){return this._focusFirstOrLast(!0,e)}focusLast(e){return this._focusFirstOrLast(!1,e)}resetFocus(e){if(!this._tabster.focusable.isVisible(e))return!1;if(this._tabster.focusable.isFocusable(e,!0,!0,!0))this.focus(e);else{const t=e.getAttribute("tabindex"),s=e.getAttribute("aria-hidden");e.tabIndex=-1,e.setAttribute("aria-hidden","true"),ie._lastResetElement=new A(this._win,e),this.focus(e,!0,!0),this._setOrRemoveAttribute(e,"tabindex",t),this._setOrRemoveAttribute(e,"aria-hidden",s)}return!0}requestAsyncFocus(e,t,s){const i=this._tabster.getWindow(),o=this._asyncFocus;if(o){if(se[e]>se[o.source])return;i.clearTimeout(o.timeout)}this._asyncFocus={source:e,callback:t,timeout:i.setTimeout(()=>{this._asyncFocus=void 0,t()},s)}}cancelAsyncFocus(e){const t=this._asyncFocus;(null==t?void 0:t.source)===e&&(this._tabster.getWindow().clearTimeout(t.timeout),this._asyncFocus=void 0)}_setOrRemoveAttribute(e,t,s){null===s?e.removeAttribute(t):e.setAttribute(t,s)}_setFocusedElement(e,t,s){var i,o;if(this._tabster._noop)return;const n={relatedTarget:t};if(e){const t=null===(i=ie._lastResetElement)||void 0===i?void 0:i.get();if(ie._lastResetElement=void 0,t===e||x(e))return;n.isFocusedProgrammatically=s;const r=$.getTabsterContext(this._tabster,e),a=null===(o=null==r?void 0:r.modalizer)||void 0===o?void 0:o.userId;a&&(n.modalizerId=a)}const r=this._nextVal={element:e?new A(this._win,e):void 0,detail:n};e&&e!==this._val&&this._validateFocusedElement(e),this._nextVal===r&&this.setVal(e,n),this._nextVal=void 0}setVal(e,t){super.setVal(e,t),e&&(this._lastVal=new A(this._win,e))}static findNextTabbable(e,t,s,i,o,n,r){const a=s||t.root.getElement();if(!a)return null;let l=null;const d=ie._isTabbingTimer,u=e.getWindow();d&&u.clearTimeout(d),ie.isTabbing=!0,ie._isTabbingTimer=u.setTimeout(()=>{delete ie._isTabbingTimer,ie.isTabbing=!1},0);const c=t.modalizer,h=t.groupper,m=t.mover,_=t=>{if(l=t.findNextTabbable(i,o,n,r),i&&!(null==l?void 0:l.element)){const o=t!==c&&k.getParentElement(t.getElement());if(o){const a=$.getTabsterContext(e,i,{referenceElement:o});if(a){const i=t.getElement(),d=n?i:i&&G(i)||i;d&&(l=ie.findNextTabbable(e,a,s,d,o,n,r),l&&(l.outOfDOMOrder=!0))}}}};if(h&&m)_(t.groupperBeforeMover?h:m);else if(h)_(h);else if(m)_(m);else if(c)_(c);else{const t={container:a,currentElement:i,referenceElement:o,ignoreAccessibility:r,useActiveModalizer:!0},s={},d=e.focusable[n?"findPrev":"findNext"](t,s);l={element:d,outOfDOMOrder:s.outOfDOMOrder,uncontrolled:s.uncontrolled}}return l}}ie.isTabbing=!1;class oe extends B{constructor(e,t,s,o){super(s,e,4,o,!0),this._setHandlers((o,n,r)=>{var a,l;const d=e.get(),u=o.input;if(d&&u){const e=$.getTabsterContext(s,u);if(e){let c;c=null===(a=t.findNextTabbable(r||void 0,void 0,n,!0))||void 0===a?void 0:a.element,c||(c=null===(l=ie.findNextTabbable(s,e,void 0,o.isOutside?u:function(e,t){let s=e,i=null;for(;s&&!i;)i=t?k.getPreviousElementSibling(s):k.getNextElementSibling(s),s=k.getParentElement(s);return i||void 0}(d,!n),void 0,n,!0))||void 0===l?void 0:l.element),c&&(0,i.kG)(c)}}})}}class ne extends z{constructor(e,t,s,i,o){super(e,t,i),this._shouldTabInside=!1,this.makeTabbable(!1),this._onDispose=s,e.controlTab||(this.dummyManager=new oe(this._element,this,e,o))}dispose(){var e;this._onDispose(this),this._element.get(),null===(e=this.dummyManager)||void 0===e||e.dispose(),delete this.dummyManager,delete this._first}findNextTabbable(e,t,s,i){const o=this.getElement();if(!o)return null;const n=Q(e)===o;if(!this._shouldTabInside&&e&&k.nodeContains(o,e)&&!n)return{element:void 0,outOfDOMOrder:!0};const r=this.getFirst(!0);if(!e||!k.nodeContains(o,e)||n)return{element:r,outOfDOMOrder:!0};const a=this._tabster;let l,d=null,c=!1;if(this._shouldTabInside&&r){const n={container:o,currentElement:e,referenceElement:t,ignoreAccessibility:i,useActiveModalizer:!0},r={};d=a.focusable[s?"findPrev":"findNext"](n,r),c=!!r.outOfDOMOrder,d||this._props.tabbability!==u.LimitedTrapFocus||(d=a.focusable[s?"findLast":"findFirst"]({container:o,ignoreAccessibility:i,useActiveModalizer:!0},r),c=!0),l=r.uncontrolled}return{element:d,uncontrolled:l,outOfDOMOrder:c}}makeTabbable(e){this._shouldTabInside=e||!this._props.tabbability}isActive(e){var t;const s=this.getElement()||null;let i=!0;for(let e=k.getParentElement(s);e;e=k.getParentElement(e)){const s=null===(t=c(this._tabster,e))||void 0===t?void 0:t.groupper;s&&(s._shouldTabInside||(i=!1))}let o=i?!!this._props.tabbability&&this._shouldTabInside:void 0;if(o&&e){const e=this._tabster.focusedElement.getFocusedElement();e&&(o=e!==this.getFirst(!0))}return o}getFirst(e){var t;const s=this.getElement();let i;if(s){if(e&&this._tabster.focusable.isFocusable(s))return s;i=null===(t=this._first)||void 0===t?void 0:t.get(),i||(i=this._tabster.focusable.findFirst({container:s,useActiveModalizer:!0})||void 0,i&&this.setFirst(i))}return i}setFirst(e){e?this._first=new A(this._tabster.getWindow,e):delete this._first}acceptElement(e,t){const s=t.cachedGrouppers,i=k.getParentElement(this.getElement()),o=i&&$.getTabsterContext(this._tabster,i),n=null==o?void 0:o.groupper,r=(null==o?void 0:o.groupperBeforeMover)?n:void 0;let a;const l=e=>{let t,i=s[e.id];return i?t=i.isActive:(t=this.isActive(!0),i=s[e.id]={isActive:t}),t};if(r&&(a=r.getElement(),!l(r)&&a&&t.container!==a&&k.nodeContains(t.container,a)))return t.skippedFocusable=!0,NodeFilter.FILTER_REJECT;const d=l(this),u=this.getElement();if(u&&!0!==d){if(u===e&&n&&(a||(a=n.getElement()),a&&!l(n)&&k.nodeContains(t.container,a)&&a!==t.container))return t.skippedFocusable=!0,NodeFilter.FILTER_REJECT;if(u!==e&&k.nodeContains(u,e))return t.skippedFocusable=!0,NodeFilter.FILTER_REJECT;const i=s[this.id];let o;if(o="first"in i?i.first:i.first=this.getFirst(!0),o&&t.acceptCondition(o))return t.rejectElementsFrom=u,t.skippedFocusable=!0,o!==t.from?(t.found=!0,t.foundElement=o,NodeFilter.FILTER_ACCEPT):NodeFilter.FILTER_REJECT}}}class re{constructor(e,t){this._current={},this._grouppers={},this._init=()=>{const e=this._win();this._tabster.focusedElement.subscribeFirst(this._onFocus);const t=e.document,s=k.getActiveElement(t);s&&this._onFocus(s),t.addEventListener("mousedown",this._onMouseDown,!0),e.addEventListener("keydown",this._onKeyDown,!0),e.addEventListener(m,this._onMoveFocus)},this._onGroupperDispose=e=>{delete this._grouppers[e.id]},this._onFocus=e=>{e&&this._updateCurrent(e)},this._onMouseDown=e=>{let t=e.target;for(;t&&!this._tabster.focusable.isFocusable(t);)t=this._tabster.getParent(t);t&&this._updateCurrent(t)},this._onKeyDown=e=>{if(e.key!==ee&&e.key!==te)return;if(e.ctrlKey||e.altKey||e.shiftKey||e.metaKey)return;const t=this._tabster.focusedElement.getFocusedElement();t&&this.handleKeyPress(t,e)},this._onMoveFocus=e=>{var t;const s=e.composedPath()[0],i=null===(t=e.detail)||void 0===t?void 0:t.action;s&&void 0!==i&&!e.defaultPrevented&&(1===i?this._enterGroupper(s):this._escapeGroupper(s),e.stopImmediatePropagation())},this._tabster=e,this._win=t,e.queueInit(this._init)}dispose(){const e=this._win();this._tabster.focusedElement.cancelAsyncFocus(1),this._current={},this._updateTimer&&(e.clearTimeout(this._updateTimer),delete this._updateTimer),this._tabster.focusedElement.unsubscribe(this._onFocus),e.document.removeEventListener("mousedown",this._onMouseDown,!0),e.removeEventListener("keydown",this._onKeyDown,!0),e.removeEventListener(m,this._onMoveFocus),Object.keys(this._grouppers).forEach(e=>{this._grouppers[e]&&(this._grouppers[e].dispose(),delete this._grouppers[e])})}createGroupper(e,t,s){const i=this._tabster,o=new ne(i,e,this._onGroupperDispose,t,s);this._grouppers[o.id]=o;const n=i.focusedElement.getFocusedElement();return n&&k.nodeContains(e,n)&&!this._updateTimer&&(this._updateTimer=this._win().setTimeout(()=>{delete this._updateTimer,n===i.focusedElement.getFocusedElement()&&this._updateCurrent(n)},0)),o}forgetCurrentGrouppers(){this._current={}}_updateCurrent(e){var t;this._updateTimer&&(this._win().clearTimeout(this._updateTimer),delete this._updateTimer);const s=this._tabster,i={};for(let o=s.getParent(e);o;o=s.getParent(o)){const n=null===(t=c(s,o))||void 0===t?void 0:t.groupper;if(n){i[n.id]=!0,this._current[n.id]=n;const t=n.isActive()||e!==o&&(!n.getProps().delegated||n.getFirst(!1)!==e);n.makeTabbable(t)}}for(const e of Object.keys(this._current)){const t=this._current[e];t.id in i||(t.makeTabbable(!1),t.setFirst(void 0),delete this._current[e])}}_enterGroupper(e,t){const s=this._tabster,i=$.getTabsterContext(s,e),o=(null==i?void 0:i.groupper)||(null==i?void 0:i.modalizerInGroupper),n=null==o?void 0:o.getElement();if(o&&n&&(e===n||o.getProps().delegated&&e===o.getFirst(!1))){const i=s.focusable.findNext({container:n,currentElement:e,useActiveModalizer:!0});if(i&&(!t||t&&n.dispatchEvent(new g({by:"groupper",owner:n,next:i,relatedEvent:t}))))return t&&(t.preventDefault(),t.stopImmediatePropagation()),i.focus(),i}return null}_escapeGroupper(e,t,s){const i=this._tabster,o=$.getTabsterContext(i,e);let n=(null==o?void 0:o.groupper)||(null==o?void 0:o.modalizerInGroupper);const r=null==n?void 0:n.getElement();if(n&&r&&k.nodeContains(r,e)){let o;if(e!==r||s)o=n.getFirst(!0);else{const e=k.getParentElement(r),t=e?$.getTabsterContext(i,e):void 0;n=null==t?void 0:t.groupper,o=null==n?void 0:n.getFirst(!0)}if(o&&(!t||t&&r.dispatchEvent(new g({by:"groupper",owner:r,next:o,relatedEvent:t}))))return n&&n.makeTabbable(!1),o.focus(),o}return null}moveFocus(e,t){return 1===t?this._enterGroupper(e):this._escapeGroupper(e)}handleKeyPress(e,t,s){const i=this._tabster,o=$.getTabsterContext(i,e);if(o&&((null==o?void 0:o.groupper)||(null==o?void 0:o.modalizerInGroupper))){if(i.focusedElement.cancelAsyncFocus(1),o.ignoreKeydown(t))return;if(t.key===ee)this._enterGroupper(e,t);else if(t.key===te){const o=i.focusedElement.getFocusedElement();i.focusedElement.requestAsyncFocus(1,()=>{(o===i.focusedElement.getFocusedElement()||(!s||o)&&s)&&this._escapeGroupper(e,t,s)},0)}}}}class ae extends X{constructor(e){super(),this._onChange=e=>{this.setVal(e,void 0)},this._keyborg=(0,i.SQ)(e()),this._keyborg.subscribe(this._onChange)}dispose(){super.dispose(),this._keyborg&&(this._keyborg.unsubscribe(this._onChange),(0,i.bd)(this._keyborg),delete this._keyborg)}setNavigatingWithKeyboard(e){var t;null===(t=this._keyborg)||void 0===t||t.setVal(e)}isNavigatingWithKeyboard(){var e;return!!(null===(e=this._keyborg)||void 0===e?void 0:e.isNavigatingWithKeyboard())}}let le=0;const de="aria-hidden";class ue extends B{constructor(e,t,s){super(t,e,2,s),this._setHandlers((s,o)=>{var n,r;const a=e.get(),l=a&&(null===(n=$.getRoot(t,a))||void 0===n?void 0:n.getElement()),d=s.input;let u;if(l&&d){const e=Q(d),s=$.getTabsterContext(t,e||d);s&&(u=null===(r=ie.findNextTabbable(t,s,l,d,void 0,o,!0))||void 0===r?void 0:r.element),u&&(0,i.kG)(u)}})}}class ce extends z{constructor(e,t,s,i,o,n){super(e,t,i),this._wasFocused=0,this.userId=i.id,this._onDispose=s,this._activeElements=n,e.controlTab||(this.dummyManager=new ue(this._element,e,o))}makeActive(e){if(this._isActive!==e){this._isActive=e;const t=this.getElement();if(t){const s=this._activeElements,i=s.map(e=>e.get()).indexOf(t);e?i<0&&s.push(new A(this._tabster.getWindow,t)):i>=0&&s.splice(i,1)}this._dispatchEvent(e)}}focused(e){return e||(this._wasFocused=++le),this._wasFocused}setProps(e){e.id&&(this.userId=e.id),this._props={...e}}dispose(){var e;this.makeActive(!1),this._onDispose(this),null===(e=this.dummyManager)||void 0===e||e.dispose(),delete this.dummyManager,this._activeElements=[],this._remove()}isActive(){return!!this._isActive}contains(e){return k.nodeContains(this.getElement(),e)}findNextTabbable(e,t,s,i){var o,n;if(!this.getElement())return null;const r=this._tabster;let a,l=null,d=!1;const u=e&&(null===(o=$.getRoot(r,e))||void 0===o?void 0:o.getElement());if(u){const o={container:u,currentElement:e,referenceElement:t,ignoreAccessibility:i,useActiveModalizer:!0},c={};l=r.focusable[s?"findPrev":"findNext"](o,c),!l&&this._props.isTrapped&&(null===(n=r.modalizer)||void 0===n?void 0:n.activeId)?(l=r.focusable[s?"findLast":"findFirst"]({container:u,ignoreAccessibility:i,useActiveModalizer:!0},c),null===l&&(l=e),d=!0):d=!!c.outOfDOMOrder,a=c.uncontrolled}return{element:l,uncontrolled:a,outOfDOMOrder:d}}_dispatchEvent(e,t){const s=this.getElement();let i=!1;if(s){const o=t?this._activeElements.map(e=>e.get()):[s];for(const t of o)if(t){const o={id:this.userId,element:s},n=e?new E(o):new y(o);t.dispatchEvent(n),n.defaultPrevented&&(i=!0)}}return i}_remove(){}}class he{constructor(e,t,s){this._onModalizerDispose=e=>{const t=e.id,s=e.userId,i=this._parts[s];if(delete this._modalizers[t],i&&(delete i[t],0===Object.keys(i).length)){delete this._parts[s];const e=this._activationHistory,t=[];let i;for(let o=e.length;o--;){const n=e[o];n!==s&&n!==i&&(i=n,(n||t.length>0)&&t.unshift(n))}if(this._activationHistory=t,this.activeId===s){const e=t[0],s=e?Object.values(this._parts[e])[0]:void 0;this.setActive(s)}}},this._onKeyDown=e=>{var t;if(e.key!==te)return;const s=this._tabster,i=s.focusedElement.getFocusedElement();if(i){const o=$.getTabsterContext(s,i),n=null==o?void 0:o.modalizer;if(o&&!o.groupper&&(null==n?void 0:n.isActive())&&!o.ignoreKeydown(e)){const i=n.userId;if(i){const o=this._parts[i];if(o){const i=Object.keys(o).map(e=>{var t;const i=o[e],n=i.getElement();let r;return n&&(r=null===(t=c(s,n))||void 0===t?void 0:t.groupper),i&&n&&r?{el:n,focusedSince:i.focused(!0)}:{focusedSince:0}}).filter(e=>e.focusedSince>0).sort((e,t)=>e.focusedSince>t.focusedSince?-1:e.focusedSince<t.focusedSince?1:0);if(i.length){const o=i[0].el;o&&(null===(t=s.groupper)||void 0===t||t.handleKeyPress(o,e,!0))}}}}}},this._onFocus=(e,t)=>{var s;const i=this._tabster,o=e&&$.getTabsterContext(i,e);if(!o||!e)return;const n=this._augMap;for(let t=e;t;t=k.getParentElement(t))n.has(t)&&(n.delete(t),j(i,t,de));let r=o.modalizer;const a=c(i,e),l=null==a?void 0:a.modalizer;if(l&&(l.focused(),l.userId===this.activeId&&a.groupper)){const t=i.getParent(e),o=t&&(null===(s=$.getTabsterContext(i,t))||void 0===s?void 0:s.modalizer);if(!o)return void this.setActive(void 0);r=o}if(null==r||r.focused(),(null==r?void 0:r.userId)!==this.activeId)if(t.isFocusedProgrammatically||this.currentIsOthersAccessible||(null==r?void 0:r.getProps().isAlwaysAccessible))this.setActive(r);else{const t=this._win();t.clearTimeout(this._restoreModalizerFocusTimer),this._restoreModalizerFocusTimer=t.setTimeout(()=>this._restoreModalizerFocus(e),100)}else this.currentIsOthersAccessible=null==r?void 0:r.getProps().isOthersAccessible},this._tabster=e,this._win=e.getWindow,this._modalizers={},this._parts={},this._augMap=new WeakMap,this._aug=[],this._alwaysAccessibleSelector=t,this._accessibleCheck=s,this._activationHistory=[],this.activeElements=[],e.controlTab||e.root.addDummyInputs(),this._win().addEventListener("keydown",this._onKeyDown,!0),e.queueInit(()=>{this._tabster.focusedElement.subscribe(this._onFocus)})}dispose(){const e=this._win();e.removeEventListener("keydown",this._onKeyDown,!0),Object.keys(this._modalizers).forEach(e=>{this._modalizers[e]&&(this._modalizers[e].dispose(),delete this._modalizers[e])}),e.clearTimeout(this._restoreModalizerFocusTimer),e.clearTimeout(this._hiddenUpdateTimer),this._parts={},delete this.activeId,this.activeElements=[],this._augMap=new WeakMap,this._aug=[],this._tabster.focusedElement.unsubscribe(this._onFocus)}createModalizer(e,t,s){var i;const o=new ce(this._tabster,e,this._onModalizerDispose,t,s,this.activeElements),n=o.id,r=t.id;this._modalizers[n]=o;let a=this._parts[r];a||(a=this._parts[r]={}),a[n]=o;const l=null!==(i=this._tabster.focusedElement.getFocusedElement())&&void 0!==i?i:null;return e!==l&&k.nodeContains(e,l)&&(r!==this.activeId?this.setActive(o):o.makeActive(!0)),o}isAugmented(e){return this._augMap.has(e)}hiddenUpdate(){this._hiddenUpdateTimer||(this._hiddenUpdateTimer=this._win().setTimeout(()=>{delete this._hiddenUpdateTimer,this._hiddenUpdate()},250))}setActive(e){const t=null==e?void 0:e.userId,s=this.activeId;if(s===t)return;if(this.activeId=t,s){const e=this._parts[s];if(e)for(const t of Object.keys(e))e[t].makeActive(!1)}if(t){const e=this._parts[t];if(e)for(const t of Object.keys(e))e[t].makeActive(!0)}this.currentIsOthersAccessible=null==e?void 0:e.getProps().isOthersAccessible,this.hiddenUpdate();const i=this._activationHistory;i[0]!==t&&(void 0!==t||i.length>0)&&i.unshift(t)}focus(e,t,s){const i=this._tabster,o=$.getTabsterContext(i,e),n=null==o?void 0:o.modalizer;if(n){this.setActive(n);const e=n.getProps(),o=n.getElement();if(o){if(void 0===t&&(t=e.isNoFocusFirst),!t&&i.keyboardNavigation.isNavigatingWithKeyboard()&&i.focusedElement.focusFirst({container:o}))return!0;if(void 0===s&&(s=e.isNoFocusDefault),!s&&i.focusedElement.focusDefault(o))return!0;i.focusedElement.resetFocus(o)}}return!1}activate(e){var t;const s=e?null===(t=$.getTabsterContext(this._tabster,e))||void 0===t?void 0:t.modalizer:void 0;return!(e&&!s||(this.setActive(s),0))}acceptElement(e,t){var s;const i=t.modalizerUserId,o=null===(s=t.currentCtx)||void 0===s?void 0:s.modalizer;if(i)for(const t of this.activeElements){const s=t.get();if(s&&(k.nodeContains(e,s)||s===e))return NodeFilter.FILTER_SKIP}const n=i===(null==o?void 0:o.userId)||!i&&(null==o?void 0:o.getProps().isAlwaysAccessible)?void 0:NodeFilter.FILTER_SKIP;return void 0!==n&&(t.skippedFocusable=!0),n}_hiddenUpdate(){var e;const t=this._tabster,s=t.getWindow().document.body,i=this.activeId,o=this._parts,n=[],r=[],a=this._alwaysAccessibleSelector,l=a?Array.from(k.querySelectorAll(s,a)):[],d=[];for(const e of Object.keys(o)){const t=o[e];for(const s of Object.keys(t)){const o=t[s],a=o.getElement(),u=o.getProps().isAlwaysAccessible;a&&(e===i?(d.push(a),this.currentIsOthersAccessible||n.push(a)):u?l.push(a):r.push(a))}}const u=this._augMap,c=n.length>0?[...n,...l]:void 0,h=[],m=new WeakMap,_=(e,s)=>{var i;const o=e.tagName;if("SCRIPT"===o||"STYLE"===o)return;let n=!1;u.has(e)?s?n=!0:(u.delete(e),j(t,e,de)):s&&!(null===(i=this._accessibleCheck)||void 0===i?void 0:i.call(this,e,d))&&j(t,e,de,"true")&&(u.set(e,!0),n=!0),n&&(h.push(new A(t.getWindow,e)),m.set(e,!0))},f=e=>{var s;for(let i=k.getFirstElementChild(e);i;i=k.getNextElementSibling(i)){let e=!1,o=!1,n=!1;if(c){const r=t.getParent(i);for(const t of c){if(i===t){e=!0;break}if(k.nodeContains(i,t)){o=!0;break}k.nodeContains(t,r)&&(n=!0)}o||(null===(s=i.__tabsterElementFlags)||void 0===s?void 0:s.noDirectAriaHidden)?f(i):e||n||_(i,!0)}else _(i,!1)}};c||l.forEach(e=>_(e,!1)),r.forEach(e=>_(e,!0)),s&&f(s),null===(e=this._aug)||void 0===e||e.map(e=>e.get()).forEach(e=>{e&&!m.get(e)&&_(e,!1)}),this._aug=h,this._augMap=m}_restoreModalizerFocus(e){var t;const s=null==e?void 0:e.ownerDocument;if(!e||!s)return;const i=this._tabster.focusedElement.getFocusedElement(),o=i&&(null===(t=$.getTabsterContext(this._tabster,i))||void 0===t?void 0:t.modalizer);if(!i||i&&(null==o?void 0:o.userId)===this.activeId)return;const n=this._tabster,r=$.getTabsterContext(n,e),a=null==r?void 0:r.modalizer,l=this.activeId;if(!a&&!l||a&&l===a.userId)return;const d=null==r?void 0:r.root.getElement();if(d){let t=n.focusable.findFirst({container:d,useActiveModalizer:!0});if(t){if(e.compareDocumentPosition(t)&document.DOCUMENT_POSITION_PRECEDING&&(t=n.focusable.findLast({container:d,useActiveModalizer:!0}),!t))throw new Error("Something went wrong.");return void n.focusedElement.focus(t)}}e.blur()}}class me{constructor(e){this._isUncontrolledCompletely=e}isUncontrolledCompletely(e,t){var s;const i=null===(s=this._isUncontrolledCompletely)||void 0===s?void 0:s.call(this,e,t);return void 0===i?t:i}}class _e extends z{constructor(e,t,s){var i;if(super(e,t,s),this._hasFocus=!1,this._onFocusOut=e=>{var t;const s=null===(t=this._element)||void 0===t?void 0:t.get();s&&null===e.relatedTarget&&s.dispatchEvent(new T),s&&!k.nodeContains(s,e.relatedTarget)&&(this._hasFocus=!1)},this._onFocusIn=()=>{this._hasFocus=!0},this._props.type===d.Source){const e=null===(i=this._element)||void 0===i?void 0:i.get();null==e||e.addEventListener("focusout",this._onFocusOut),null==e||e.addEventListener("focusin",this._onFocusIn),this._hasFocus=k.nodeContains(e,e&&k.getActiveElement(e.ownerDocument))}}dispose(){var e;if(this._props.type===d.Source){const t=null===(e=this._element)||void 0===e?void 0:e.get();null==t||t.removeEventListener("focusout",this._onFocusOut),null==t||t.removeEventListener("focusin",this._onFocusIn),this._hasFocus&&this._tabster.getWindow().document.body.dispatchEvent(new T)}}}class fe{constructor(e){this._stack=[],this._getWindow=e}push(e){var t;(null===(t=this._stack[this._stack.length-1])||void 0===t?void 0:t.get())!==e&&(this._stack.length>fe.DEPTH&&this._stack.shift(),this._stack.push(new A(this._getWindow,e)))}pop(e=()=>!0){var t;const s=this._getWindow().document;for(let i=this._stack.length-1;i>=0;i--){const i=null===(t=this._stack.pop())||void 0===t?void 0:t.get();if(i&&k.nodeContains(s.body,k.getParentElement(i))&&e(i))return i}}}fe.DEPTH=10;class ve{constructor(e){this._onRestoreFocus=e=>{var t,s;this._focusedElementState.cancelAsyncFocus(2);const i=e.composedPath()[0];if(i){const e=null===(s=null===(t=c(this._tabster,i))||void 0===t?void 0:t.restorer)||void 0===s?void 0:s.getProps().id;this._focusedElementState.requestAsyncFocus(2,()=>this._restoreFocus(i,e),0)}},this._onFocusIn=e=>{var t;if(!e)return;const s=c(this._tabster,e);(null===(t=null==s?void 0:s.restorer)||void 0===t?void 0:t.getProps().type)===d.Target&&this._history.push(e)},this._restoreFocus=(e,t)=>{var s;const i=this._getWindow().document;if(k.getActiveElement(i)!==i.body)return;if(!this._keyboardNavState.isNavigatingWithKeyboard()&&k.nodeContains(i.body,e))return;const o=e=>{var t,s;const i=null===(s=null===(t=c(this._tabster,e))||void 0===t?void 0:t.restorer)||void 0===s?void 0:s.getProps();return i?i.id:null};null===(s=this._history.pop(e=>t===o(e)))||void 0===s||s.focus()},this._tabster=e,this._getWindow=e.getWindow,this._getWindow().addEventListener(_,this._onRestoreFocus),this._history=new fe(this._getWindow),this._keyboardNavState=e.keyboardNavigation,this._focusedElementState=e.focusedElement,this._focusedElementState.subscribe(this._onFocusIn)}dispose(){const e=this._getWindow();this._focusedElementState.unsubscribe(this._onFocusIn),this._focusedElementState.cancelAsyncFocus(2),e.removeEventListener(_,this._onRestoreFocus)}createRestorer(e,t){const s=new _e(this._tabster,e,t);return t.type===d.Target&&k.getActiveElement(e.ownerDocument)===e&&this._history.push(e),s}}class be{static _overrideAttachShadow(e){const t=e.Element.prototype.attachShadow;t.__origAttachShadow||(Element.prototype.attachShadow=function(e){const s=t.call(this,e);for(const e of be._shadowObservers)e._addSubObserver(s);return s},Element.prototype.attachShadow.__origAttachShadow=t)}constructor(e){this._isObserving=!1,this._callbackWrapper=(e,t)=>{for(const t of e)if("childList"===t.type){const e=t.removedNodes,s=t.addedNodes;for(let t=0;t<e.length;t++)this._walkShadows(e[t],!0);for(let e=0;e<s.length;e++)this._walkShadows(s[e])}this._callback(e,t)},this._callback=e,this._observer=new MutationObserver(this._callbackWrapper),this._subObservers=new Map}_addSubObserver(e){if(this._options&&this._callback&&!this._subObservers.has(e)&&this._options.subtree&&function(e,t){var s,i;if(!e||!t)return!1;let o=t;for(;o;){if(o===e)return!0;o="function"!=typeof o.assignedElements&&(null===(s=o.assignedSlot)||void 0===s?void 0:s.parentNode)?null===(i=o.assignedSlot)||void 0===i?void 0:i.parentNode:o.nodeType===document.DOCUMENT_FRAGMENT_NODE?o.host:o.parentNode}return!1}(this._root,e)){const t=new MutationObserver(this._callbackWrapper);this._subObservers.set(e,t),this._isObserving&&t.observe(e,this._options),this._walkShadows(e)}}disconnect(){this._isObserving=!1,delete this._options,be._shadowObservers.delete(this);for(const e of this._subObservers.values())e.disconnect();this._subObservers.clear(),this._observer.disconnect()}observe(e,t){const s=e.nodeType===Node.DOCUMENT_NODE?e:e.ownerDocument,i=null==s?void 0:s.defaultView;s&&i&&(be._overrideAttachShadow(i),be._shadowObservers.add(this),this._root=e,this._options=t,this._isObserving=!0,this._observer.observe(e,t),this._walkShadows(e))}_walkShadows(e,t){const s=e.nodeType===Node.DOCUMENT_NODE?e:e.ownerDocument;if(s){if(e===s)e=s.body;else{const t=e.shadowRoot;if(t)return void this._addSubObserver(t)}s.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{if(e.nodeType===Node.ELEMENT_NODE)if(t){const t=this._subObservers.get(e);t&&(t.disconnect(),this._subObservers.delete(e))}else{const t=e.shadowRoot;t&&this._addSubObserver(t)}return NodeFilter.FILTER_SKIP}}).nextNode()}}takeRecords(){const e=this._observer.takeRecords();for(const t of this._subObservers.values())e.push(...t.takeRecords());return e}}be._shadowObservers=new Set;class pe{constructor(e){this.keyboardNavigation=e.keyboardNavigation,this.focusedElement=e.focusedElement,this.focusable=e.focusable,this.root=e.root,this.uncontrolled=e.uncontrolled,this.core=e}}class ge{constructor(e,t){var s,i;this._forgetMemorizedElements=[],this._wrappers=new Set,this._initQueue=[],this._version="8.7.0",this._noop=!1,this.getWindow=()=>{if(!this._win)throw new Error("Using disposed Tabster.");return this._win},this._storage=function(e){const t=e.__tabsterInstanceContext;return new((null==t?void 0:t.basics.WeakMap)||WeakMap)}(e),this._win=e;const n=this.getWindow;(null==t?void 0:t.DOMAPI)&&function(e){for(const t of Object.keys(e))k[t]=e[t]}({...t.DOMAPI}),this.keyboardNavigation=new ae(n),this.focusedElement=new ie(this,n),this.focusable=new Z(this),this.root=new $(this,null==t?void 0:t.autoRoot),this.uncontrolled=new me((null==t?void 0:t.checkUncontrolledCompletely)||(null==t?void 0:t.checkUncontrolledTrappingFocus)),this.controlTab=null===(s=null==t?void 0:t.controlTab)||void 0===s||s,this.rootDummyInputs=!!(null==t?void 0:t.rootDummyInputs),this._dummyObserver=new K(n),this.getParent=null!==(i=null==t?void 0:t.getParent)&&void 0!==i?i:k.getParentNode,this.internal={stopObserver:()=>{this._unobserve&&(this._unobserve(),delete this._unobserve)},resumeObserver:e=>{if(!this._unobserve){const t=n().document;this._unobserve=function(e,t,s,i){if("undefined"==typeof MutationObserver)return()=>{};const n=t.getWindow;let r;function a(t,s){r||(r=O(n).elementByUId),l(t,s);const i=R(e,t,e=>l(e,s));if(i)for(;i.nextNode(););}function l(e,i){var a;if(!e.getAttribute)return NodeFilter.FILTER_SKIP;const l=e.__tabsterElementUID;return l&&r&&(i?delete r[l]:null!==(a=r[l])&&void 0!==a||(r[l]=new A(n,e))),(c(t,e)||e.hasAttribute(o))&&s(t,e,i),NodeFilter.FILTER_SKIP}const d=k.createMutationObserver(e=>{var i,n,r,l,d;const u=new Set;for(const d of e){const e=d.target,c=d.removedNodes,h=d.addedNodes;if("attributes"===d.type)d.attributeName===o&&(u.has(e)||s(t,e));else{for(let s=0;s<c.length;s++){const o=c[s];u.add(o),a(o,!0),null===(n=(i=t._dummyObserver).domChanged)||void 0===n||n.call(i,e)}for(let s=0;s<h.length;s++)a(h[s]),null===(l=(r=t._dummyObserver).domChanged)||void 0===l||l.call(r,e)}}u.clear(),null===(d=t.modalizer)||void 0===d||d.hiddenUpdate()});return i&&a(n().document.body),d.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:[o]}),()=>{d.disconnect()}}(t,this,h,e)}}},N(n),this.queueInit(()=>{this.internal.resumeObserver(!0)})}_mergeProps(e){var t;e&&(this.getParent=null!==(t=e.getParent)&&void 0!==t?t:this.getParent)}createTabster(e,t){const s=new pe(this);return e||this._wrappers.add(s),this._mergeProps(t),s}disposeTabster(e,t){t?this._wrappers.clear():this._wrappers.delete(e),0===this._wrappers.size&&this.dispose()}dispose(){var e,t,s,i,o,n,r,a;this.internal.stopObserver();const l=this._win;null==l||l.clearTimeout(this._initTimer),delete this._initTimer,this._initQueue=[],this._forgetMemorizedElements=[],l&&this._forgetMemorizedTimer&&(l.clearTimeout(this._forgetMemorizedTimer),delete this._forgetMemorizedTimer),null===(e=this.outline)||void 0===e||e.dispose(),null===(t=this.crossOrigin)||void 0===t||t.dispose(),null===(s=this.deloser)||void 0===s||s.dispose(),null===(i=this.groupper)||void 0===i||i.dispose(),null===(o=this.mover)||void 0===o||o.dispose(),null===(n=this.modalizer)||void 0===n||n.dispose(),null===(r=this.observedElement)||void 0===r||r.dispose(),null===(a=this.restorer)||void 0===a||a.dispose(),this.keyboardNavigation.dispose(),this.focusable.dispose(),this.focusedElement.dispose(),this.root.dispose(),this._dummyObserver.dispose(),function(e){const t=O(e);t.fakeWeakRefsStarted=!1,t.fakeWeakRefsTimer&&(e().clearTimeout(t.fakeWeakRefsTimer),t.fakeWeakRefsTimer=void 0,t.fakeWeakRefs=[])}(this.getWindow),W(this.getWindow),this._storage=new WeakMap,this._wrappers.clear(),l&&(function(e){const t=e.__tabsterInstanceContext;t&&(t.elementByUId={},delete t.WeakRef,t.containerBoundingRectCache={},t.containerBoundingRectCacheTimer&&e.clearTimeout(t.containerBoundingRectCacheTimer),t.fakeWeakRefsTimer&&e.clearTimeout(t.fakeWeakRefsTimer),t.fakeWeakRefs=[],delete e.__tabsterInstanceContext)}(l),delete l.__tabsterInstance,delete this._win)}storageEntry(e,t){const s=this._storage;let i=s.get(e);return i?!1===t&&0===Object.keys(i).length&&s.delete(e):!0===t&&(i={},s.set(e,i)),i}forceCleanup(){this._win&&(this._forgetMemorizedElements.push(this._win.document.body),this._forgetMemorizedTimer||(this._forgetMemorizedTimer=this._win.setTimeout(()=>{delete this._forgetMemorizedTimer;for(let e=this._forgetMemorizedElements.shift();e;e=this._forgetMemorizedElements.shift())W(this.getWindow,e),ie.forgetMemorized(this.focusedElement,e)},0),P(this.getWindow,!0)))}queueInit(e){var t;this._win&&(this._initQueue.push(e),this._initTimer||(this._initTimer=null===(t=this._win)||void 0===t?void 0:t.setTimeout(()=>{delete this._initTimer,this.drainInitQueue()},0)))}drainInitQueue(){if(!this._win)return;const e=this._initQueue;this._initQueue=[],e.forEach(e=>e())}}function Ee(e,t){let s=function(e){return e.__tabsterInstance}(e);return s?s.createTabster(!1,t):(s=new ge(e,t),e.__tabsterInstance=s,s.createTabster())}function ye(e){const t=e.core;return t.groupper||(t.groupper=new re(t,t.getWindow)),t.groupper}function Te(e,t,s){const i=e.core;return i.modalizer||(i.modalizer=new he(i,t,s)),i.modalizer}function we(e){const t=e.core;return t.restorer||(t.restorer=new ve(t)),t.restorer}function Fe(e,t){e.core.disposeTabster(e,t)}}}]);